<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.83.0"><meta name=viewport content="width=device-width,initial-scale=1"><title>Activity LaunchMode &#183; Learn Or Die</title><meta name=description content><link type=text/css rel=stylesheet href=https://neohsu.github.io/css/print.css media=print><link type=text/css rel=stylesheet href=https://neohsu.github.io/css/poole.css><link type=text/css rel=stylesheet href=https://neohsu.github.io/css/syntax.css><link type=text/css rel=stylesheet href=https://neohsu.github.io/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-09><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src="http://www.gravatar.com/avatar/a6974d6335aac6400019a5bd307aeca8?s=200" alt="Profile Picture" style="width:200px;border-radius:50%;margin:1rem auto">
<a href=https://neohsu.github.io/><h1>Learn Or Die</h1></a><p class=lead>Code wins arguments.</p></div><nav><ul class=sidebar-nav><li><a href=https://neohsu.github.io/>Home</a></li><li><a href=https://github.com/neohsu>GitHub</a></li></ul></nav><p>&copy; 2021. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Activity LaunchMode</h1><time datetime=2014-11-03T17:50:23+0800 class=post-date>Mon, Nov 3, 2014</time><p>最近遇到 onActivityResult 沒有反應的問題，找了些許資料後才發現原來自己忽略了 Activity 啟動的原點，這邊紀錄一下 Activity 的啟動模式</p><p>Activity 的啟動模式在 <code>androidManifest.xml</code> 中設定</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;activity</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.MainActivity&#34;</span> <span style=color:#a6e22e>android:launchMode=</span><span style=color:#e6db74>&#34;standard&#34;</span><span style=color:#960050;background-color:#1e0010>&lt;/activity</span><span style=color:#f92672>&gt;</span>
</code></pre></div><h3 id=activity-launchmode>Activity LaunchMode</h3><ul><li><strong>standard</strong> : 每次 startActivity 都會產生新的 Activity Instance</li><li><strong>singleTop</strong> : 當 startActivity 已經有相同的 Activity Instance 在佇列中，且是 Top 狀態時，不產生新的 Activity Instance</li><li><strong>singleTask</strong> : 所有 startActivity 都會產生唯一的 Activity Instance 並存在於主 Task 中</li><li><strong>singleInstance</strong> : 當 startActivity 後該 Activity 會存於在和主 Task 不同的 Task 中且 Activity Instance 是唯一的</li></ul><h3 id=standard-example>Standard Example</h3><p>standard 為 Activity LaunchMode 的預設值，如果沒有設定 LaunchMode 就會以 standard 來運行
使用 Standard 運作原理如下</p><blockquote><p><code>狀況題</code> A &ndash;start&ndash;> A &ndash;start&ndash;> B &ndash;start&ndash;> A &ndash;back&ndash;> B &ndash;back&ndash;> A<br><code>Queue</code> A A B A &ndash;back&ndash;> A A B &ndash;back&ndash;> A A</p></blockquote><h3 id=singletop-example>SingleTop Example</h3><p>如果當下的 Activity 不是在最上層，則會產生一個新的 Activity
使用 SingleTop 運作原理如下</p><blockquote><p><code>狀況題</code> A &ndash;start&ndash;> A &ndash;start&ndash;> B &ndash;start&ndash;> A &ndash;back&ndash;> B &ndash;back&ndash;> A<br><code>Queue</code> A &ndash;start&ndash;> A &ndash;start&ndash;> A B &ndash;start&ndash;> A B A &ndash;back&ndash;> A B &ndash;back&ndash;> A</p></blockquote><h3 id=singletask-example>SingleTask Example</h3><p>同一個 Task 中只能有一個 Activity，如果在發現 Activity 的 Instance 已經存在，則清空這個 Instance 之上的 Activity
使用 SingleTask 運作原理如下</p><blockquote><p><code>狀況題</code> A &ndash;start&ndash;> B &ndash;start&ndash;> B &ndash;start&ndash;> C &ndash;start&ndash;> D &ndash;start&ndash;> B<br><code>Queue</code> A B &ndash;start&ndash;> A B &ndash;start&ndash;> A B C &ndash;start&ndash;> A B C D &ndash;start&ndash;> A B</p></blockquote><h3 id=singleinstance-example>SingleInstance Example</h3><p>Activity 用一個新的 Task 來裝載啟動，而且保證不再有其他 Activity Instance 進入
使用 SingleInstance 運作原理如下</p><blockquote><p>A => standard<br>B => singleInstance<br>開啟順序為 A(task1) &ndash;start&ndash;> B(task2) &ndash;start&ndash;> A(task1)<br>當按 Back 鍵時 A(task1) &ndash;back&ndash;> A(task1) &ndash;back&ndash;> B(task2)</p></blockquote><h3 id=onactivityresult-調用的時機>onActivityResult 調用的時機</h3><ol><li>在 standard, singleTop 兩個模式下 onActivityResult 方法會在當前的 Activity 結束掉後被調用</li><li>在 singleTask, singleInstance 兩個模式下 onActivityResult 方法會立即調用，等到再 setResult 的時候就不再作用了</li></ol><blockquote><p>setResult 方法與 onActivityResult 方法是不同步的，使用上要多加注意</p></blockquote></div></main></body></html>