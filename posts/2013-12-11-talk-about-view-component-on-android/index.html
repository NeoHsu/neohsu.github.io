<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.83.1"><meta name=viewport content="width=device-width,initial-scale=1"><title>Talk About View Component On Android &#183; Learn Or Die</title><meta name=description content><link type=text/css rel=stylesheet href=https://neohsu.github.io/css/print.css media=print><link type=text/css rel=stylesheet href=https://neohsu.github.io/css/poole.css><link type=text/css rel=stylesheet href=https://neohsu.github.io/css/syntax.css><link type=text/css rel=stylesheet href=https://neohsu.github.io/css/hyde.css><link type=text/css rel=stylesheet href=https://neohsu.github.io/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-09><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><img src="http://www.gravatar.com/avatar/a6974d6335aac6400019a5bd307aeca8?s=200" alt="Profile Picture" style="width:200px;border-radius:50%;margin:1rem auto">
<a href=https://neohsu.github.io/><h1>Learn Or Die</h1></a><p class=lead>Code wins arguments.</p></div><nav><ul class=sidebar-nav><li><a href=https://neohsu.github.io/>Home</a></li><a href=https://www.facebook.com/NeoHsuDroid><i class="fab fa-facebook" style=margin-right:.5rem></i></a><a href=https://github.com/neohsu><i class="fab fa-github" style=margin-right:.5rem></i></a><a href=https://www.linkedin.com/in/neohsu><i class="fab fa-linkedin" style=margin-right:.5rem></i></a><a href=https://twitter.com/neohsudroid><i class="fab fa-twitter" style=margin-right:.5rem></i></a></ul></nav><p>&copy; 2021. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Talk About View Component On Android</h1><time datetime=2013-12-11T22:51:29+0800 class=post-date>Wed, Dec 11, 2013</time><p>{% img /images/SVG/1-talk-about-view-component-on-android.svg %}</p><p>在 Android 開發中，我認為了解 View 的執行過程有助於提高介面呈現的效率，可以幫助一些複雜 Layout 在適當的時機中處理，或是可以減少不必要的畫面重製，這些都是對於 View 的執行過程有很大的關聯</p><p>Android 中 View 的呈現主要經過 Mesure, Layout 和 Draw 這三個過程：</p><h2 id=mesure>Mesure</h2><p>此階段主要是負責計算 view 佔用的大小，簡單的說就是將 match_parent 和 wrap_content 轉成目前顯示的實際大小；透過 onMeasure(widthMeasureSpec, heightMeasureSpec) 方法去處理計算 View 在目前螢幕上顯示的區塊大小</p><blockquote><p>View 的大小是有 Parent View 和自己的大小决定而不是單一個 View 來决定，因此需要配合自己的 Sub-View 去做計算調整</p></blockquote><h2 id=layout>Layout</h2><p>當 View 配置好大小後，便讀取設定好的 Layout 配置，將 Layout 佈局放到建立好的 View 中並計算出 View 在螢幕上的座標；透過 onLayout(int l, int t, int r, int b )方法去處理</p><blockquote><p>處理組件的佈局通常要重寫 onMesure 和 onLayout 這兩個方法</p></blockquote><h2 id=draw>Draw</h2><p>Draw 過程中主要是先畫 Drawable 背景，需注意的是背景 Drawable 的實際大小會影響 View 的大小； Draw 過程會調用 onDraw(Canvas canvas) 方法去繪製背景，之後再透過 dispatchDraw(Canvas canvas) 方法分發給 Sub-View 進行繪製，值得注意的是 ViewGroup 在繪製時，如果它沒有背景則直接調用的是 dispatchDraw() 方法，繞過了 draw() 方法，當它有背景的時候就調用 draw() 方法，而 draw() 方法裡包含了 dispatchDraw() 方法的調用</p><blockquote><p>自定組件時通常是重寫 onDraw() 方法，而在 ViewGroup 上繪製東西的時候往往重寫的是 dispatchDraw() 方法</p></blockquote><h2 id=summary>Summary</h2><p>Android 中所有畫面都是用 Canvas 根據座標去畫出來的結果，因此每次當 View 改變的時候，需要再去重新計算與繪製一個 View 來產生出畫面來</p><p>可想而知在 ListView 中，我們不斷地 onScroll 時，如果沒做一些效能處理與緩存的處理，它的運作模式將會是不斷地重新繪製畫面；因為當每次移動 Scroll 時都會進行 getView 的動作，之後便開始一連串產生 View 的行為</p></div></main></body></html>